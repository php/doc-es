 <reference id="ref.mcrypt">
  <title>Funciones Criptográficas</title>
  <titleabbrev>mcrypt</titleabbrev>
  
  <partintro>
   <para>
    Estas funciones trabajan usando <ulink url="&url.mcrypt;">mcrypt</ulink>.</para>

   <para>
    Esta es una interfaz a la librería mcrypt, que soporta una gran
    variedad de algoritmos de bloque como DES, TripleDES, Blowfish
    (por defecto), 3-WAY, SAFER-SK64, SAFER-SK128, TWOFISH, TEA, RC2 y
    GOST en los modos de cifrado CBC, OFB, CFB y ECB. Adicionalmente, soporta
    RC6 e IDEA que se consideran "no-libres".</para>

   <para>
    Para usarlos, descarga libmcrypt-x.x.tar.gz de <ulink url="&url.mcrypt;">aquí</ulink> y sigue las instrucciones
    de instalación incluidas. Necesitas compilar PHP con el parámetro 
    <option role="configure">--with-mcrypt</option> para activar esta extensión.</para>

   <para>
    mcrypt puede usarse para encriptar y desencriptar usando los cifrados
    mencionados arriba. Los cuatro comandos importantes de mcrypt
    (<function>mcrypt_cfb</function>, <function>mcrypt_cbc</function>,
    <function>mcrypt_ecb</function>, y
    <function>mcrypt_ofb</function>) pueden operar en ambos modos que
    se llaman MCRYPT_ENCRYPT y MCRYPT_DECRYPT, respectivamente.
    
    <example>
     <title>Encripta un valor de entrada con TripleDES en modo ECB</title>
     <programlisting role="php">
&lt;?php
$key = "esta es una clave muy secreta";
$input = "Nos vemos a las 9 en punto en el lugar secreto.";

$encrypted_data = mcrypt_ecb(MCRYPT_TripleDES, $key, $input, MCRYPT_ENCRYPT);
?&gt;
     </programlisting>
    </example>
	  
    Este ejemplo devolverá los datos encriptados como una cadena en
    $encrypted_data.</para> 

   <para>
    mcrypt puede operar en cuatro modos de cifrado (CBC, OFB, CFB y ECB). Perfilaremos
    el uso normal de cada uno de estos modos. Para una mejor referencia y una discusión
    más completa ver &book.applied.cryptography;.

    <itemizedlist>
     <listitem><simpara>
      ECB (electronic codebook o libro de códigos electrónico) va bien para datos aleatorios, tales como
      encriptar otras claves. Puesto que los datos son cortos y aleatorios, las desventajas de
      ECB tienen un efecto negativo favorable.</simpara></listitem>

     <listitem><simpara>
      CBC (cipher block chaining o cifrado en bloque encadenado) es especialmente útil para encriptar ficheros,
      donde incrementa significativamente la seguridad por encima de ECB.</simpara></listitem> 

     <listitem><simpara>
      CFB (cipher feedback o cifrado realimentado) es el mejor modo de encriptar flujos de bytes donde
      cada byte debe ser encriptado.</simpara></listitem>

     <listitem><simpara>
      OFB (output feedback o salida realimentada) es comparable al CFB, pero puede usarse en
      aplicaciones donde la propagación de errores no puede tolerarse.</simpara></listitem> 
    </itemizedlist></para>
    
   <para>
    Actualmente PHP no soporta el encriptado/desencriptado de flujos de bits.
    Por ahora, sólo soporta el manejo de cadenas.</para>

   <para>
    Para una lista completa de los cifrados soportados, ver las definiciones al final de
    mcrypt.h. La regla general es que se puede acceder al cifrado desde PHP con
    MCRYPT_nombredelcifrado.</para> 
   
   <para>
    Aquí hay una pequeña lista de los cifrados que estan soportados actualmente por la
    extensión mcrypt. Si un cifrado no está listado aquí, pero está listado por mcrypt
    como soportado, puedes asumir con seguridad que ésta documentación está caduca.

    <itemizedlist>

     <listitem><simpara>
      MCRYPT_BLOWFISH</simpara></listitem>
     <listitem><simpara>
      MCRYPT_DES</simpara></listitem>
     <listitem><simpara>
      MCRYPT_TripleDES</simpara></listitem>
     <listitem><simpara>
      MCRYPT_ThreeWAY</simpara></listitem>
     <listitem><simpara>
      MCRYPT_GOST</simpara></listitem>
     <listitem><simpara>
      MCRYPT_CRYPT</simpara></listitem>
     <listitem><simpara>
      MCRYPT_DES_COMPAT</simpara></listitem>
     <listitem><simpara>
      MCRYPT_SAFER64</simpara></listitem>
     <listitem><simpara>
      MCRYPT_SAFER128</simpara></listitem>
     <listitem><simpara>
      MCRYPT_CAST128</simpara></listitem>
     <listitem><simpara>
      MCRYPT_TEAN</simpara></listitem>
     <listitem><simpara>
      MCRYPT_RC2</simpara></listitem>
     <listitem><simpara>
      MCRYPT_TWOFISH (para las antiguas versiones mcrypt 2.x)</simpara></listitem>
     <listitem><simpara>
      MCRYPT_TWOFISH128 (TWOFISHxxx está disponible en las versiones más nuevas 2.x)</simpara></listitem>
     <listitem><simpara>
      MCRYPT_TWOFISH192</simpara></listitem>
     <listitem><simpara>
      MCRYPT_TWOFISH256</simpara></listitem>
     <listitem><simpara>
      MCRYPT_RC6</simpara></listitem>
     <listitem><simpara>
      MCRYPT_IDEA</simpara></listitem>

    </itemizedlist></para>

   <para>
    Debes (en los modos CFB y OFB) o puedes (en el modo CBC) suministrar un
    vector de inicialización (IV) a la correspondiente función de cifrado. El IV debe
    ser único y debe ser el mismo cuando desencriptas o encriptas. Con datos que son
    guardados encriptados, puedes cojer la salida de una función de índice
    bajo la cual los datos son almacenados (ej. la clave MD5 de un fichero).
    Alternativamente, puedes transmitir el IV junto con los datos encriptados
    (ver capítulo 9.3 de &book.applied.cryptography; para una discusión de éste
    asunto).</para>

  </partintro>
  
  <refentry id="function.mcrypt-get-cipher-name">
   <refnamediv>
    <refname>mcrypt_get_cipher_name</refname>
    <refpurpose>Obtiene el nombre del cifrado especificado</refpurpose>
   </refnamediv>
   <refsect1>
    <title>Descripción</title>
    <funcsynopsis>
     <funcdef>string <function>mcrypt_get_cipher_name</function></funcdef>
     <paramdef>int <parameter>cipher</parameter></paramdef>
    </funcsynopsis>
	
    <para>
     <function>mcrypt_get_cipher_name</function> se usa para obtener el nombre
     del cifrado especificado.</para>

    <para>
     <function>mcrypt_get_cipher_name</function> toma como argumento el número de cifrado
     y devuelve el nombre del cifrado o false, si el cifrado no
     existe.</para>
     
    <para>
     <example>
      <title>Ejemplo de mcrypt_get_cipher_name</title>
      <programlisting>
&lt;?php
$cipher = MCRYPT_TripleDES;

print mcrypt_get_cipher_name($cipher);
?&gt;
      </programlisting>
     </example></para>
	 
    <para>
     El ejemplo de más arriba da como resultado:
     <programlisting>
TripleDES
     </programlisting></para>
	
   </refsect1>
  </refentry>
  
  <refentry id="function.mcrypt-get-block-size">
   <refnamediv>
    <refname>mcrypt_get_block_size</refname>
    <refpurpose>Obtiene el tamaño de bloque del cifrado indicado</refpurpose>
   </refnamediv>
   <refsect1>
    <title>Descripción</title>
    <funcsynopsis>
     <funcdef>int <function>mcrypt_get_block_size</function></funcdef>
     <paramdef>int <parameter>cipher</parameter></paramdef>
    </funcsynopsis>
	
    <para>
     <function>mcrypt_get_block_size</function> se usa para obtener el tamaño
     de bloque del cifrado indicado en <parameter>cipher</parameter>.</para>

    <para>
     <function>mcrypt_get_block_size</function> toma un argumento, el cifrado
     <parameter>cipher</parameter> y devuelve el tamaño en bytes.</para> 

    <para>
     Ver también: <function>mcrypt_get_key_size</function></para>

   </refsect1>
  </refentry>
  
  <refentry id="function.mcrypt-get-key-size">
   <refnamediv>
    <refname>mcrypt_get_key_size</refname>
    <refpurpose>Obtiene el tamaño de la clave de un cifrado</refpurpose>
   </refnamediv>
   <refsect1>
    <title>Descripción</title>
    <funcsynopsis>
     <funcdef>int <function>mcrypt_get_key_size</function></funcdef>
     <paramdef>int <parameter>cipher</parameter></paramdef>
    </funcsynopsis>
	
    <para>
     <function>mcrypt_get_key_size</function> se usa para obtener el tamaño de la clave
     del cifrado indicado en <parameter>cipher</parameter>.</para>

    <para>
     <function>mcrypt_get_key_size</function> toma un argumento, el cifrado
     <parameter>cipher</parameter> y devuelve el tamaño de la clave en bytes.</para> 

    <para>
     Ver también: <function>mcrypt_get_block_size</function></para>

   </refsect1>
  </refentry>
  
  <refentry id="function.mcrypt-create-iv">
   <refnamediv>
    <refname>mcrypt_create_iv</refname>
    <refpurpose>Crea un vector de inicialización (IV) a partir de una fuente aleatoria</refpurpose>
   </refnamediv>
   <refsect1>
    <title>Descripción</title>
    <funcsynopsis>
     <funcdef>string
     <function>mcrypt_create_iv</function></funcdef>
     <paramdef>int <parameter>size</parameter></paramdef>
     <paramdef>int <parameter>source</parameter></paramdef>
    </funcsynopsis>
	
    <para>
     <function>mcrypt_create_iv</function> se usa para crear un IV.</para>

    <para>
     <function>mcrypt_create_iv</function> toma dos argumentos,
     <parameter>size</parameter> determina el tamaño del IV,
     <parameter>source</parameter> especifica la fuente del IV.</para> 
     
    <para>
     La fuente puede ser MCRYPT_RAND (generador de números aleatorios del sistema),
     MCRYPT_DEV_RANDOM (que lee datos de /dev/random) y MCRYPT_DEV_URANDOM
     (que lee datos de /dev/urandom). Si usas MCRYPT_RAND, asegurate de llamar
     antes a srand() para inicializar el generador de números aleatorios.</para>

    <para>
     <example>
      <title>Ejemplo de mcrypt_create_iv</title>
      <programlisting>
&lt;?php
$cipher = MCRYPT_TripleDES;
$block_size = mcrypt_get_block_size($cipher);
$iv = mcrypt_create_iv($block_size, MCRYPT_DEV_RANDOM);
?&gt;
      </programlisting>
     </example></para>

   </refsect1>
  </refentry>
 
  <refentry id="function.mcrypt-cbc">
   <refnamediv>
    <refname>mcrypt_cbc</refname>
    <refpurpose>Encripta/desencripta datos en modo CBC</refpurpose>
   </refnamediv>
   <refsect1>
    <title>Descripción</title>
    <funcsynopsis>
     <funcdef>int <function>mcrypt_cbc</function></funcdef>
     <paramdef>int <parameter>cipher</parameter></paramdef>
     <paramdef>string <parameter>key</parameter></paramdef>
     <paramdef>string <parameter>data</parameter></paramdef>
     <paramdef>int <parameter>mode</parameter></paramdef>
     <paramdef>string <parameter><optional>iv</optional></parameter></paramdef>
    </funcsynopsis>
	
    <para>
     <function>mcrypt_cbc</function> encripta o desencripta (dependiendo de
     <parameter>mode</parameter>) los datos <parameter>data</parameter> con el cifrado 
     <parameter>cipher</parameter> y la clave <parameter>key</parameter> en el modo de
     cifrado CBC y devuelve la cadena resultante.</para>
    
    <para>
     El parámetro <parameter>cipher</parameter> es una de las constantes con nombre MCRYPT_nombrecifrado.</para>

    <para>
     <parameter>key</parameter> es la clave suministrada al algoritmo. Debe
     guardarse en secreto.</para>  

    <para>
     <parameter>data</parameter> son los datos que serán
     encriptados/desencriptados.</para> 
     
    <para>
     <parameter>mode</parameter> es MCRYPT_ENCRYPT o MCRYPT_DECRYPT.</para>

    <para>
     <parameter>iv</parameter> es el vector de inicialización opcional.</para>

    <para>
     Ver también:
     <function>mcrypt_cfb</function>,
     <function>mcrypt_ecb</function>,
     <function>mcrypt_ofb</function></para>
	 
   </refsect1>
  </refentry>

  <refentry id="function.mcrypt-cfb">
   <refnamediv>
    <refname>mcrypt_cfb</refname>
    <refpurpose>Encripta/desencripta datos en modo CFB</refpurpose>
   </refnamediv>
   <refsect1>
    <title>Descripción</title>
    <funcsynopsis>
     <funcdef>int <function>mcrypt_cfb</function></funcdef>
     <paramdef>int <parameter>cipher</parameter></paramdef>
     <paramdef>string <parameter>key</parameter></paramdef>
     <paramdef>string <parameter>data</parameter></paramdef>
     <paramdef>int <parameter>mode</parameter></paramdef>
     <paramdef>string <parameter>iv</parameter></paramdef>
    </funcsynopsis>
	
    <para>
     <function>mcrypt_cfb</function> encripta o desencripta (dependiendo de
     <parameter>mode</parameter>) los datos <parameter>data</parameter> con el cifrado
     <parameter>cipher</parameter> y la clave <parameter>key</parameter> en el modo de
     cifrado CFB y devuelve la cadena resultante.</para>

   <para>
     El parámetro <parameter>cipher</parameter> es una de las constantes con nombre MCRYPT_nombrecifrado.</para>

    <para>
     <parameter>key</parameter> es la clave suministrada al algoritmo. Debe
     guardarse en secreto.</para>

    <para>
     <parameter>data</parameter> son los datos que serán
     encriptados/desencriptados.</para>

    <para>
     <parameter>mode</parameter> es MCRYPT_ENCRYPT o MCRYPT_DECRYPT.</para>    

    <para>
     <parameter>iv</parameter> es el vector de inicialización.</para>

    <para>
     Ver también:
     <function>mcrypt_cbc</function>,
     <function>mcrypt_ecb</function>,
     <function>mcrypt_ofb</function></para>
	 
   </refsect1>
  </refentry>
  
  <refentry id="function.mcrypt-ecb">
   <refnamediv>
    <refname>mcrypt_ecb</refname>
    <refpurpose>Encripta/desencripta datos en modo ECB</refpurpose>
   </refnamediv>
   <refsect1>
    <title>Descripción</title>
    <funcsynopsis>
     <funcdef>int <function>mcrypt_ecb</function></funcdef>
     <paramdef>int <parameter>cipher</parameter></paramdef>
     <paramdef>string <parameter>key</parameter></paramdef>
     <paramdef>string <parameter>data</parameter></paramdef>
     <paramdef>int <parameter>mode</parameter></paramdef>
    </funcsynopsis>
	
    <para>
     <function>mcrypt_ecb</function> encripta o desencripta (dependiendo de
     <parameter>mode</parameter>) los datos <parameter>data</parameter> con el cifrado
     <parameter>cipher</parameter> y la clave <parameter>key</parameter> en el modo de
     cifrado ECB y devuelve la cadena resultante.</para>

   <para>
     El parámetro <parameter>cipher</parameter> es una de las constantes con nombre MCRYPT_nombrecifrado.</para>

    <para>
     <parameter>key</parameter> es la clave suministrada al algoritmo. Debe
     guardarse en secreto.</para>

    <para>
     <parameter>data</parameter> son los datos que serán
     encriptados/desencriptados.</para>

    <para>
     <parameter>mode</parameter> es MCRYPT_ENCRYPT o MCRYPT_DECRYPT.</para>

    <para>
     Ver también:
     <function>mcrypt_cbc</function>,
     <function>mcrypt_cfb</function>,
     <function>mcrypt_ofb</function></para>
	 
   </refsect1>
  </refentry>

  <refentry id="function.mcrypt-ofb">
   <refnamediv>
    <refname>mcrypt_ofb</refname>
    <refpurpose>Encripta/desencripta datos en modo OFB</refpurpose>
   </refnamediv>
   <refsect1>
    <title>Descripción</title>
    <funcsynopsis>
     <funcdef>int <function>mcrypt_ofb</function></funcdef>
     <paramdef>int <parameter>cipher</parameter></paramdef>
     <paramdef>string <parameter>key</parameter></paramdef>
     <paramdef>string <parameter>data</parameter></paramdef>
     <paramdef>int <parameter>mode</parameter></paramdef>
     <paramdef>string <parameter>iv</parameter></paramdef>
    </funcsynopsis>

    <para>
     <function>mcrypt_ofb</function> encripta o desencripta (dependiendo de
     <parameter>mode</parameter>) los datos <parameter>data</parameter> con el cifrado
     <parameter>cipher</parameter> y la clave <parameter>key</parameter> en el modo de
     cifrado OFB y devuelve la cadena resultante.</para>

   <para>
     El parámetro <parameter>cipher</parameter> es una de las constantes con nombre MCRYPT_nombrecifrado.</para>

    <para>
     <parameter>key</parameter> es la clave suministrada al algoritmo. Debe
     guardarse en secreto.</para>

    <para>
     <parameter>data</parameter> son los datos que serán
     encriptados/desencriptados.</para>

    <para>
     <parameter>mode</parameter> es MCRYPT_ENCRYPT o MCRYPT_DECRYPT.</para>

    <para>
     <parameter>iv</parameter> es el vector de inicialización.</para>	

    <para>
     Ver también:
     <function>mcrypt_cbc</function>,
     <function>mcrypt_cfb</function>,
     <function>mcrypt_ecb</function></para>
	 
   </refsect1>
  </refentry>
 
 </reference> 

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
sgml-parent-document:nil
sgml-default-dtd-file:"../manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
-->
