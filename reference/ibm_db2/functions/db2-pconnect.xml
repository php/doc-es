<?xml version="1.0" encoding="utf-8"?>
<!-- $Revision$ -->
<!-- EN-Revision: e41806c30bf6975e452c0d4ce35ab0984c2fa68c Maintainer: tardeenfamenor Status: ready -->
<!-- Reviewed: no -->

<!-- Generated by xml_proto.php v2.2. Found in /scripts directory of phpdoc. -->
<refentry xml:id="function.db2-pconnect" xmlns="http://docbook.org/ns/docbook">
 <refnamediv>
  <refname>db2_pconnect</refname>
  <refpurpose>
   Devolver una conexión persistente a la base de datos
  </refpurpose>
 </refnamediv>
 <refsect1 role="description">
  &reftitle.description;
  <methodsynopsis>
   <type>resource</type><methodname>db2_pconnect</methodname>
   <methodparam><type>string</type><parameter>database</parameter></methodparam>
   <methodparam><type>string</type><parameter>username</parameter></methodparam>
   <methodparam><type>string</type><parameter>password</parameter></methodparam>
   <methodparam choice="opt"><type>array</type><parameter>options</parameter></methodparam>
  </methodsynopsis>


  <para>
   Devuelve una conexión persistente a una base de datos IBM DB2 Universal Database, IBM
   Cloudscape o Apache Derby. 
  </para>

  <para>
   Más información acerca de conexiones persistentes
   se puede encontrar en: <xref linkend='features.persistent-connections' />.
  </para>

  <para>
   Si se llama a <function>db2_close</function> en una conexión persistente, siempre 
   se devolverá &true;, sin embargo la conexión permenecerá abierta en modo de espera para
   utilizarse en la siguiente solicitud de <function>db2_pconnect</function>.
  </para>

  <para>
   Para las versiones 1.9.0 y superiores de ibm_db2, hay que considerar que 
   al final de la solicitud siempre se ejecutará una cancelación ("rollback") de la transacción en la 
   conexión persistente para terminar la transacción. Lo anterior evita que el bloqueo de información 
   permanezca en la siguiente solicitud que utilice esa conexión.
  </para>

 </refsect1>
 <refsect1 role="parameters">
  &reftitle.parameters;
  <para>
   <variablelist>
    <varlistentry>
     <term><parameter>database</parameter></term>
     <listitem>
      <para>
       El álias de la base de datos en al catálogo del cliente DB2.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><parameter>username</parameter></term>
     <listitem>
      <para>
       El usuario con el se conecta a la base de datos.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><parameter>password</parameter></term>
     <listitem>
      <para>
       La contraseña con la que se conecta a la base de datos.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><parameter>options</parameter></term>
     <listitem>
      <para>
       Un arreglo asociativo de opciones que afectan el comportamiento de 
       la conexión, entre las claves válidas están:
       <variablelist>
        <varlistentry>
         <term><parameter>autocommit</parameter></term>
         <listitem>
          <para>
           Si se pasa el valor  <literal>DB2_AUTOCOMMIT_ON</literal> se  
           confirmarán automáticamente las transacciones de la conexión.
          </para>
          <para>
           Si se pasa el valor <literal>DB2_AUTOCOMMIT_OFF</literal> no se 
           confirmarán automáticamente las transacciones de la conexión.
          </para>
         </listitem>
        </varlistentry>
        <varlistentry>
         <term><parameter>DB2_ATTR_CASE</parameter></term>
         <listitem>
          <para>
           Si se pasa el valor <literal>DB2_CASE_NATURAL</literal> los nombres 
           de las columnas serán devueltos con sus mayúsculas y minúsculas originales.
          </para>
          <para>
           Si se pasa el valor <literal>DB2_CASE_LOWER</literal> los nombres 
           de las columnas serán devueltos en minúsculas.
          </para>
          <para>
           Si se pasa el valor <literal>DB2_CASE_UPPER</literal> los nombres 
           de las columnas serán devueltos en mayúsculas.
          </para>
         </listitem>
        </varlistentry>
        <varlistentry>
         <term><parameter>CURSOR</parameter></term>
         <listitem>
          <para>
           Si se pasa el valor <literal>DB2_FORWARD_ONLY</literal> se establece 
           un cursor de no-recorrido (sólo hacia adelante). Este cursor es predeterminado 
           y soportado por todos los servidores de base de datos.
          </para>
          <para>
           Si se pasa el valor <literal>DB2_SCROLLABLE</literal> se establece 
           un cursor de recorrido. Con este modo es posible acceder de manera 
           aleatoria a las filas del resultado pero actualmente sólo es soportado 
           por IBM DB2 Universal Database.
          </para>
         </listitem>
        </varlistentry>
       </variablelist>
      </para>
      <para>
       Las siguientes opciones están disponibles en las versiones 1.7.0 y superiores de 
       ibm_db2. 
       <variablelist>
        <varlistentry>
         <term><parameter>trustedcontext</parameter></term>
         <listitem>
          <para>
           Si se pasa el valor DB2_TRUSTED_CONTEXT_ENABLE se establece una conexión 
           de confianza. Este parámetro no puede ser establecido mediante  
           <function>db2_set_option</function>.
          </para>
          <para>
           Esta clave solo funciona si la base de datos está catalogada (aún cuando  
           la base de datos sea local), o si se especifica un DSN completo cuando se   
           crea la conexión.
          </para>
          <para>
           Para catalogar la base de datos se usan los siguientes comandos:
          </para>
          <para>
           <literallayout>db2 catalog tcpip node loopback remote &lt;SERVERNAME&gt; server &lt;SERVICENAME&gt;
db2 catalog database &lt;LOCALDBNAME&gt; as &lt;REMOTEDBNAME&gt; at node loopback
db2 "update dbm cfg using svcename &lt;SERVICENAME&gt;"
db2set DB2COMM=TCPIP</literallayout>
          </para>
          
         </listitem>
        </varlistentry>             
      </variablelist>
      </para>
      <para>
       Las siguientes opciones i5/OS están disponibles en las versiones 1.5.1 y superiores de ibm_db2.
       <tip>
        <para>Si se utilizan atributos de conexión conflictivos en conexiones persistentes  
         se pueden provocar resultados indeterminados en i5/OS. Las políticas de sitio deberían establecer
         el uso de perfiles con conexiones persistentes para todas las aplicacioneses.
         Se sugiere el uso de DB2_AUTOCOMMIT_ON en conexiones persistentes.
        </para>
       </tip>
       <variablelist>
        <varlistentry>
         <term><parameter>i5_lib</parameter></term>
         <listitem>
          <para>
           Una cadena que indica la lista de bibliotecas que se utilizará por default para resolver 
           referencias no evaluadas a archivos. Este parámetro no es válido  
           si en la conexión se utiliza el modo de nombrado de sistema.
          </para>
         </listitem>
        </varlistentry>
        <varlistentry>
         <term><parameter>i5_naming</parameter></term>
         <listitem>
          <para>
           <literal>DB2_I5_NAMING_ON</literal> habilita el modo de nombrado de sistema DB2 UDB CLI iSeries.
           Los archivos son evaluados utilizando una diagonal (/) como delimitador. 
           Los archivos que no pueden ser evaluados son resueltos utilizando la lista de bibliotecas.
          </para>
          <para>
           <literal>DB2_I5_NAMING_OFF</literal> esta valor predeterminado habilita el modo de nombrado DB2 UDB CLI,  
           que es el sistema de nombrado de SQL. Los archivos son evaluados utilizando un punto (.) 
           como delimitador. Los archivos que no se pueden evaluar son resueltos utilizando tanto la biblioteca predeterminada 
           como el identificador del usuario actual.
          </para>
         </listitem>
        </varlistentry>
        <varlistentry>
         <term><parameter>i5_commit</parameter></term>
         <listitem>
          <para>
           Se recomienda establecer el parámetro <parameter>i5_commit</parameter> antes que  
           <function>db2_pconnect</function>. Si el valor es modificado después de que la conexión ha  
           sido establecida y la conexión es hacia una fuente remota, el cambio no tendrá efecto hasta
           la siguiente llamada exitosa a <function>db2_pconnect</function> para el manejo de conexión.
           <note>
            <para>
             El parámetro <parameter>ibm_db2.i5_allow_commit</parameter>==0 en php.ini o 
             <literal>DB2_I5_TXN_NO_COMMIT</literal> son opciones predeterminadas pero pueden ser remplazadas  
             con la opción <parameter>i5_commit</parameter>.
            </para>
           </note>           
          </para>
          <para>
           <literal>DB2_I5_TXN_NO_COMMIT</literal> - No se utiliza ningún control de transacciones.
          </para>
          <para>
           <literal>DB2_I5_TXN_READ_UNCOMMITTED</literal> - Se permiten lecturas sucias, lecturas no repetibles,  
           y lecturas fantasma.
          </para>
          <para>
           <literal>DB2_I5_TXN_READ_COMMITTED</literal> - No se permiten lecturas sucias. Se permiten  
           lecturas no repetibles y lecturas fantasma.
          </para>
          <para>
           <literal>DB2_I5_TXN_REPEATABLE_READ</literal> - No se permiten lecturas sucias ni lecturas  
           no repetibles. Se permiten lecturas fantasma.
          </para>
          <para>
           <literal>DB2_I5_TXN_SERIALIZABLE</literal> - Las transacciones son serializables. 
           No se permiten lecturas sucias, lecturas no repetibles ni lecturas fantasma.
          </para>
         </listitem>
        </varlistentry>
        <varlistentry>
         <term><parameter>i5_query_optimize</parameter></term>
         <listitem>
          <para>
            <literal>DB2_FIRST_IO</literal> - Todas las consultas son optimazadas con el objetivo de  
            devolver la primera página de resultados lo más rápido posible. Esta opción se recomienda cuando el resultado    
            es controlado por un usuario que puede cancelar la consulta después de  
            visualizar la primera página de resultados. Esta funcionalidad también se puede lograr utilizando OPTIMIZE FOR nnn ROWS 
            en una consulta.
          </para>
          <para>
           <literal>DB2_ALL_IO</literal> - Todas las consultas son optimizadas con el objetivo de ejecutar  
           la consulta completa en el menor tiempo posible. Esta opción predeterminada se recomienda cuando el resultado de 
           una consulta es escrito en un archivo o reporte. Esta funcionalidad tambien se puede lograr utilizando OPTIMIZE FOR nnn ROWS 
           en una consulta. 
          </para>
         </listitem>
        </varlistentry>
        <varlistentry>
         <term><parameter>i5_dbcs_alloc</parameter></term>
         <listitem>
          <para>
           <literal>DB2_I5_DBCS_ALLOC_ON</literal> habilita el esquema de alojamiento DB2 6X para  
           incremento de tamaño en columnas de traducción DBCS.
          </para>
          <para>
           <literal>DB2_I5_DBCS_ALLOC_OFF</literal> deshabilita el esquema de alojamiento DB2 6X para  
           incremento de tamaño en columnas de traducción DBCS. 
           <note>
            <para>
             El parámetro <parameter>ibm_db2.i5_dbcs_alloc</parameter>==0 en php.ini o 
             <literal>DB2_I5_DBCS_ALLOC_OFF</literal> son opciones predeterminadas pero pueden ser remplazadas con  
             la opción <parameter>i5_dbcs_alloc</parameter>.
            </para>
           </note>
           </para>
         </listitem>
        </varlistentry>
        <varlistentry>
         <term><parameter>i5_date_fmt</parameter></term>
         <listitem>
          <para>
           <literal>DB2_I5_FMT_ISO</literal> - Se utiliza el formato de fechas estandar (ISO) yyyy-mm-dd. 
           Esta opción es predeterminada.
          </para>
          <para>
           <literal>DB2_I5_FMT_USA</literal> - Se utiliza el formato de fechas de Estados Unidos mm/dd/yyyy.
          </para>
          <para>
           <literal>DB2_I5_FMT_EUR</literal> - Se utiliza el formato de fechas Europeo dd.mm.yyyy.
          </para>
          <para>
           <literal>DB2_I5_FMT_JIS</literal> - Se utiliza el formato de fechas Japonés yyyy-mm-dd. 
          </para>
          <para>
           <literal>DB2_I5_FMT_MDY</literal> - Se utiliza el formato de fechas mm/dd/yyyy. 
          </para>
          <para>
           <literal>DB2_I5_FMT_DMY</literal> - Se utiliza el formato de fechas dd/mm/yyyy.
          </para>
          <para>
           <literal>DB2_I5_FMT_YMD</literal> - Se utiliza el formato de fechas yy/mm/dd.
          </para>
          <para>
           <literal>DB2_I5_FMT_JUL</literal> - Se utiliza el formato de fechas Juliano yy/ddd.
          </para>
          <para>
           <literal>DB2_I5_FMT_JOB</literal> - El formato de trabajo es utilizado.
          </para>
         </listitem>
        </varlistentry>
        <varlistentry>
         <term><parameter>i5_date_sep</parameter></term>
         <listitem>
          <para>
           <literal>DB2_I5_SEP_SLASH</literal> - Se utiliza una diagonal ( / ) como separador de fechas. 
           Esta opción es predeterminada.
          </para>
          <para>
           <literal>DB2_I5_SEP_DASH</literal> - Se utiliza un guión medio ( - ) como separador de fechas.
          </para>
          <para>
           <literal>DB2_I5_SEP_PERIOD</literal> - Se utiliza un punto ( . ) como separador de fechas.
          </para>
          <para>
           <literal>DB2_I5_SEP_COMMA</literal> - Se utiliza una coma ( , ) como separador de fechas.
          </para>
          <para>
           <literal>DB2_I5_SEP_BLANK</literal> - Se utiliza un espacio como separador de fechas.
          </para>
          <para>
           <literal>DB2_I5_SEP_JOB</literal> - Se utiliza el separador de fechas de trabajo.
          </para>
         </listitem>
        </varlistentry>     
        <varlistentry>
         <term><parameter>i5_time_fmt</parameter></term>
         <listitem>
          <para>
           <literal>DB2_I5_FMT_ISO</literal> - Se utiliza el formato de tiempo estandar (ISO) hh.mm.ss. 
           Esta opción es predeterminada.
          </para>
          <para>
           <literal>DB2_I5_FMT_USA</literal> - Se utiliza el formato de tiempo de Estados Unidos hh:mmxx, donde xx es AM o PM.
          </para>
          <para>
           <literal>DB2_I5_FMT_EUR</literal> - Se utiliza el formato de tiempo Europeo hh.mm.ss.
          </para>
          <para>
           <literal>DB2_I5_FMT_JIS</literal> - Se utiliza el formato de tiempo Japonés hh:mm:ss.
          </para>
          <para>
           <literal>DB2_I5_FMT_HMS</literal> - Se utiliza el formato de tiempo hh:mm:ss.
          </para>
         </listitem>
        </varlistentry>
        <varlistentry>
         <term><parameter>i5_time_sep</parameter></term>
         <listitem>
          <para>
           <literal>DB2_I5_SEP_COLON</literal> - Se utiliza el signo de dos puntos ( : ) como separador de tiempo. Esta opción es predeterminada.
          </para>
          <para>
           <literal>DB2_I5_SEP_PERIOD</literal> - Se utiliza un punto ( . ) como separador de tiempo.
          </para>
          <para>
           <literal>DB2_I5_SEP_COMMA</literal> - Se utiliza una coma ( , ) como separador de tiempo.
          </para>
          <para>
           <literal>DB2_I5_SEP_BLANK</literal> - Se utiliza un espacio como separador de tiempo.
          </para>
          <para>
           <literal>DB2_I5_SEP_JOB</literal> - Se utiliza el separador de tiempo de trabajo.
          </para>
         </listitem>
        </varlistentry>
        <varlistentry>
         <term><parameter>i5_decimal_sep</parameter></term>
         <listitem>
          <para>
           <literal>DB2_I5_SEP_PERIOD</literal> - Se utiliza un punto ( . ) como separador decimal. Esta opción es predeterminada.
          </para>
          <para>
           <literal>DB2_I5_SEP_COMMA</literal> - Se utiliza una coma ( , ) como separador decimal.
          </para>
          <para>
           <literal>DB2_I5_SEP_JOB</literal> - Se utiliza el separador decimal de trabajo.
          </para>
         </listitem>
        </varlistentry>        
       </variablelist>
      </para> 
      <para>
       La siguiente opción i5/OS está disponible en las versiones 1.8.0 y superiores de ibm_db2.  
       <variablelist>
        <varlistentry>
         <term><parameter>i5_libl</parameter></term>
         <listitem>
          <para>
           Un cadena que indica la lista de bibliotecas que se utilizará para resolver  
           referencias no evaluadas a archivos. Se especifican los elementos de la lista  
           separados por espacios 'i5_libl'=>"LIBRERIA1 LIBRERIA2 LIBRERIA3". 
           <note>
            <para>
             i5_libl llama a qsys2/qcmdexc('cmd',cmdlen), que sólo está disponible en  
             i5/OS V5R4 y versiones superiores.
            </para>
           </note>
          </para>
         </listitem>
        </varlistentry>         
       </variablelist>
      </para>      
     </listitem>
    </varlistentry>
   </variablelist>
  </para>
 </refsect1>
 <refsect1 role="returnvalues">
  &reftitle.returnvalues;
  <para>
   Devuelve un recurso de conexión si el intento de conexión es exitoso. 
   <function>db2_pconnect</function> intenta reutilizar recursos de conexión existentes que coinciden 
   exactamente con los parámetros <parameter>database</parameter>, <parameter>username</parameter>, y 
   <parameter>password</parameter>. Si el intento de conexión falla 
   <function>db2_pconnect</function> devuelve &false;.
  </para>
 </refsect1>

 <refsect1 role="changelog">
  &reftitle.changelog;
  <para>
   <informaltable>
    <tgroup cols="2">
     <thead>
      <row>
       <entry>&Version;</entry>
       <entry>&Description;</entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry>ibm_db2 1.9.0</entry>
       <entry>
        Las transacciones activas en una conexión persistente serán canceladas al final de cada solicitud.
       </entry>
      </row>
      <row>
       <entry>ibm_db2 1.8.0</entry>
       <entry>
        La opción <parameter>i5_libl</parameter> está disponible para los usuarios de i5/OS.
       </entry>
      </row>
      <row>
       <entry>ibm_db2 1.7.0</entry>
       <entry>
        La opción <parameter>trustedcontext</parameter> está disponible.
       </entry>
      </row>
      <row>
       <entry>ibm_db2 1.5.1</entry>
       <entry>
        Las opciones <parameter>i5_lib</parameter>, 
        <parameter>i5_naming</parameter>,
        <parameter>i5_commit</parameter>,
        <parameter>i5_query_optimize</parameter>,
        <parameter>i5_dbcs_alloc</parameter>,
        <parameter>i5_date_fmt</parameter>,
        <parameter>i5_date_sep</parameter>,
        <parameter>i5_time_fmt</parameter>, 
        <parameter>i5_time_sep</parameter>
        y <parameter>i5_decimal_sep</parameter> están disponibles para los usuarios de i5/OS.
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </para>
 </refsect1>

 <refsect1 role="examples">
  &reftitle.examples;
  <para>
   <example>
    <title>Ejemplo de <function>db2_pconnect</function></title>
    <para>
     En el siguiente ejemplo, la primera llamada a 
     <function>db2_pconnect</function> devuelve un nuevo recurso de conexión persistente. 
     La segunda llamada a <function>db2_pconnect</function> devuelve 
     un recurso de conexión persistente que reutiliza el primer recurso.
    </para>
    <programlisting role="php">
<![CDATA[
<?php
$database = 'SAMPLE';
$user = 'db2inst1';
$password = 'ibmdb2';

$pconn = db2_pconnect($database, $user, $password);

if ($pconn) {
    echo "Persistent connection succeeded.";
}
else {
    echo "Persistent connection failed.";
}

$pconn2 = db2_pconnect($database, $user, $password);
if ($pconn) {
    echo "Second persistent connection succeeded.";
}
else {
    echo "Second persistent connection failed.";
}
?>
]]>
    </programlisting>
    &example.outputs;
    <screen>
<![CDATA[
Persistent connection succeeded.
Second persistent connection succeeded.
]]>
    </screen>
   </example>
   <example>
    <title>Utilizando contexto de confianza</title>
    <para>
     El siguiente ejemplo muestra como habilitar el contexto de confianza, cambia usuarios y 
     obtiene el identificador del usuario actual.
    </para>
    <programlisting role="php">
<![CDATA[
<?php

$database = "SAMPLE";
$hostname = "localhost";
$port = 50000;
$authID = "db2inst1";
$auth_pass = "ibmdb2";

$tc_user = "tcuser";
$tc_pass = "tcpassword";

$dsn = "DATABASE=$database;HOSTNAME=$hostname;PORT=$port;
  PROTOCOL=TCPIP;UID=$authID;PWD=$auth_pass;";
$options = array ("trustedcontext" => DB2_TRUSTED_CONTEXT_ENABLE);

$tc_conn = db2_pconnect($dsn, "", "", $options);
if($tc_conn) {
    echo "Explicit trusted connection succeeded.\n";

    if(db2_get_option($tc_conn, "trustedcontext")) {
        $userBefore = db2_get_option($tc_conn, "trusted_user");
        
        //Do some work as user 1.

        //Switching to trusted user.
        $parameters = array("trusted_user" => $tc_user, 
          "trusted_password" => $tcuser_pass);
        $res = db2_set_option ($tc_conn, $parameters, 1);

        $userAfter = db2_get_option($tc_conn, "trusted_user");
        //Do more work as trusted user.

        if($userBefore != $userAfter) {
            echo "User has been switched." . "\n";    
        }
    }

    db2_close($tc_conn);
}
else {
    echo "Explicit trusted connection failed.\n";
}
?>

]]>
    </programlisting>
    &example.outputs;
    <screen>
<![CDATA[
Explicit trusted connection succeeded.
User has been switched.
]]>
    </screen>
   </example>
  </para>
 </refsect1>

 <refsect1 role="seealso">
  &reftitle.seealso;
  <para>
   <simplelist>
    <member><function>db2_connect</function></member>
   </simplelist>
  </para>
 </refsect1>


</refentry>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"~/.phpdoc/manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
