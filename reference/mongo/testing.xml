<?xml version="1.0" encoding="utf-8"?>
<!-- $Revision$ -->
<!-- EN-Revision: 8b6d169424ff189bb563ef4c3f35f8adff3f42c5 Maintainer: chuso Status: ready -->

<section xml:id="mongo.testing" xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">
 <title>Ejecutando los Test del Driver</title>

 <para>
  El paquete PECL no incluyen los test, pero están disponible es
  <link xlink:href="&url.mongodb.github;">Github</link>. Hay dos tipos de test:
  Los test de PHP y los test en C.
 </para>

 <section>
  <title>TEst PHPUnit</title>
  <para>
   Para ejecutarlos, debe descargar el driver de Github (los test se encuentran en
   el directorio <literal>tests/</literal>). También necesitará
   <link xlink:href="&url.phpunit.install;">PHPUnit</link> para ejecutar los test.
   PHPUnit también se puede instalar mediante PEAR (hay un par de prerrequisitos
   que podrá consultar en las instrucciones de instalación).
  </para>
  <para>
   Algunos test esperarán que se produzcan alertas y errores, por lo que se debe asignar 
   <literal>error_reporting</literal> en <literal>php.ini</literal> a
   <literal>E_STRICT | E_ALL</literal> para que pasen estos test. En caso contrario,
   se obtendrán errores que indicaran que el test esperaba que se emitiera una alerta
   o error.
  </para>
  <para>
   Para ejecutarlos, asegúrese de que el servidor de MongoDB se está ejecutando en local en
   el puerto 27017. Antes de notificar de un error, por favor, asegúrese de que ha ejecutado los test
   contra la última versión de desarrollo de MongoDB: a veces hay errores para funcionalidades que
   ya no se encuentran en la versión estable.
  </para>
  <para>
   La suite de pruebas usa la base de datos "phpunite". En caso de que utilice en su aplicación 
   una base de datos llamada "phpunit", asegúrese de indicar a MongoDB un nuevo directorio de datos
   antes de ejecutar los test.
  </para>
  <para>
   Asegúrese de que se encuentra en el directorio principal del código fuente del driver que
   descargó de Github. Ejecute:
  </para>
  <programlisting>
<![CDATA[

$ phpunit tests/MongoSuite.php

]]>
 </programlisting>
 </section>

 <section>
  <title>Tests C</title>
  <para>
   Los test en C comprueban sobre todo funciones internas que no están expuertas a PHP.
   Si deseara ejecutar estos test, deberá compilar PHP con la bandera
   <literal>--enable-embed</literal>. Después, acceda al directorio
   <filename>tests</filename> y ejecute <literal>make</literal>. Se creará
   un binario llamado <literal>unit</literal>. Llame a
   <literal>unit</literal> para ejecutar los test. Estos test no necesitan ninguna base de datos
   para funcionar.
  </para>

  <para>
   Cuando se pase un test, se imprimirá un ".". Si un test falla, se informará
   y se dentrán las pruebas. Por favor, notifique cualquier error.
  </para>

  <para>
   Si <literal>make</literal> no pudiera localizar su biblioteca empotrada PHP (libphp5.so)
   o los ficheros de cabeceras, deberá especificar un valor en la variable
   <literal>PHP_PATH</literal>.
  </para>

  <para>
   Ejecute <literal>make clean</literal> todos los objetos usados para los tests.
  </para>

  <para>
   Si ejecuta estos test con <filename>valgrind</filename>, no debería obtener ningún error
   de acceso no válido a memoria, ni tampoco el mensaje de "no leaks are possible"
   que se muestra al final.
  </para>
 </section>

 <section>
  <title>Notificando Errores</title>
  <para>
   Por favor, notifique cualquier fallo o error en el
   <link xlink:href="&url.mongodb.jira;">bugtracker</link>. Podría haber test que se omitan.
   Esto es normal, por lo que puede ignorarlo.
  </para>
  <para>
   ¡Los nuevos test siempre son bienvenidos! Por favor, no dude en contribuir con nuevos test
   de cualquier tipo que pongan a prueba cualquier funcionalidad.
  </para>
 </section>
</section>
